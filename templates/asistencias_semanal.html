{% extends 'base.html' %}
{% block title %}Asistencias Semanal{% endblock %}

{% block content %}
<div class="container-xl py-5">

  <!-- Barra superior sticky -->
  <div class="d-flex flex-wrap gap-2 justify-content-between align-items-center mb-4 sticky-top bg-white pt-2 pb-2" style="z-index:3;">
    <div class="d-flex align-items-center gap-3">
      <h2 class="fw-bold mb-0" style="letter-spacing:-.5px;">
        <i class="bi bi-calendar-week text-primary me-2"></i>
        Resumen Semanal de Asistencias
      </h2>
      <span class="badge bg-primary-subtle text-primary fs-6">
        {{ semana[0].strftime('%d/%m') }} al {{ semana[-1].strftime('%d/%m') }}
      </span>
    </div>
    <a href="/" class="btn btn-outline-secondary rounded-pill">
      <i class="bi bi-arrow-left me-1"></i>Volver
    </a>
  </div>

  <!-- NavegaciÃ³n semanas -->
  <div class="d-flex flex-wrap justify-content-center align-items-center gap-3 mb-4">
    <a href="/asistencias_semanal?semana_offset={{ semana_offset - 1 }}"
       class="btn btn-light rounded-pill px-3 shadow-sm border">
      <i class="bi bi-arrow-left"></i> Semana anterior
    </a>
    <span class="fw-semibold fs-5 text-primary-subtle px-2">
      Semana del {{ semana[0].strftime('%d/%m') }} al {{ semana[-1].strftime('%d/%m') }}
    </span>
    <a href="/asistencias_semanal?semana_offset={{ semana_offset + 1 }}"
       class="btn btn-light rounded-pill px-3 shadow-sm border">
      Semana siguiente <i class="bi bi-arrow-right"></i>
    </a>
  </div>

  <!-- Tabla de asistencias -->
  <div class="table-responsive card shadow-sm border-0 rounded-4 px-0 py-0">
    <table class="table table-bordered mb-0 text-center align-middle bg-white">
      <thead class="table-primary">
        <tr>
          <th style="min-width:130px;" class="text-start bg-primary-subtle text-primary">Docente</th>
          {% for dia in semana %}
            <th class="bg-light">
              <span class="d-block small text-secondary" style="font-weight:600;">
                {{ dia.strftime('%a').capitalize() }}
              </span>
              <span class="fw-normal">{{ dia.strftime('%d/%m') }}</span>
            </th>
          {% endfor %}
          <th class="bg-info-subtle text-info">A tiempo</th>
          <th class="bg-warning-subtle text-warning">Tarde</th>
          <th class="bg-success-subtle text-success">Justificaciones</th>
          <th class="bg-danger-subtle text-danger">Inasistencias</th>
        </tr>
      </thead>
      <tbody>
        {% for dni, datos in asistencias.items() %}
          <tr>
            <td class="text-start">{{ datos.nombre }}</td>
            {% for dia in semana %}
              <td>
                {% set valor = datos.dias[dia] %}
                {% if valor == 'âœ”' %}
                  <span class="text-success fs-5" title="A tiempo">âœ”</span>
                {% elif valor == 'ðŸ•’' %}
                  <span class="text-warning fs-5" title="Tarde">ðŸ•’</span>
                {% elif valor == 'âœ—' %}
                  <span class="text-danger fs-5" title="Inasistencia">âœ—</span>
                {% elif valor == 'Jâœ”' %}
                  <span class="text-success fs-5" title="Justificada">
                    <i class="bi bi-file-earmark-check-fill"></i>
                  </span>
                {% elif valor == 'Jâ§—' %}
                  <span class="text-warning fs-5" title="JustificaciÃ³n pendiente">
                    <i class="bi bi-file-earmark"></i>
                  </span>
                {% elif valor == 'ðŸ…¿' %}
                  <span class="text-primary fs-5" title="Con Permiso">ðŸ…¿</span>
                {% elif valor == 'ðŸ”•' %}
                  <span class="text-secondary fs-5" title="DÃ­a no laborable">ðŸ”•</span>
                {% elif valor == 'â€”' %}
                  <span class="text-muted" title="Sin registro">â€”</span>
                {% else %}
                  <span class="text-muted">?</span>
                {% endif %}
              </td>
            {% endfor %}
            <td class="bg-info-subtle text-info">{{ datos.atiempo }}</td>
            <td class="bg-warning-subtle text-warning">{{ datos.tarde }}</td>
            <td class="bg-success-subtle text-success">{{ datos.justif }}</td>
            <td class="bg-danger-subtle text-danger">{{ datos.inasist }}</td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr class="fw-bold table-secondary">
          <td class="text-start">Totales</td>
          {% for _ in semana %}
            <td></td>
          {% endfor %}
          <td class="bg-info-subtle text-info">{{ total_atiempo }}</td>
          <td class="bg-warning-subtle text-warning">{{ total_tarde }}</td>
          <td class="bg-success-subtle text-success">{{ total_justif }}</td>
          <td class="bg-danger-subtle text-danger">{{ total_inasist }}</td>
        </tr>
      </tfoot>
    </table>
  </div>
</div>

<style>
  .bg-primary-subtle { background: #e3f2fd !important; }
  .bg-info-subtle { background: #e6f7fa !important; }
  .bg-warning-subtle { background: #fff9e3 !important; }
  .bg-success-subtle { background: #e2fbe9 !important; }
  .bg-danger-subtle { background: #ffeaea !important; }
  .table-primary th { background: #e3f2fd !important; color: #0d47a1; }
  .table-bordered td, .table-bordered th { border-color: #d3e0f3; }
  .table-responsive.card { border-radius: 1.1rem !important; }
</style>
{% endblock %}
